#!/usr/bin/python
import os
import re

def sanitize_for_android(directory="."):
    # 1. Define the forbidden characters for Android/FAT32/exFAT
    # We include : because it's common in Linux but illegal on Android storage
    forbidden_chars = r'[<>:"/\\|?*]'

    files = [f for f in os.listdir(directory) if os.path.isfile(os.path.join(directory, f))]

    for filename in files:
        # Separate extension to avoid messing with the dot
        name, ext = os.path.splitext(filename)

        # 2. Replace forbidden characters with an underscore
        new_name = re.sub(forbidden_chars, '_', name)

        # 3. Replace spaces with underscores (optional, remove if you like spaces)
        new_name = new_name.replace(' ', '_')

        # 4. Remove leading dots or spaces (Android hides files starting with .)
        new_name = new_name.lstrip('. ')

        # 5. Clean up multiple underscores created by the replacements
        new_name = re.sub(r'_+', '_', new_name).strip('_')

        # Re-join with extension
        final_name = f"{new_name}{ext}"

        if filename != final_name:
            old_path = os.path.join(directory, filename)
            new_path = os.path.join(directory, final_name)

            # Prevent overwriting if the new name already exists
            if os.path.exists(new_path):
                print(f"Skipping: {final_name} already exists.")
            else:
                os.rename(old_path, new_path)
                print(f"Renamed: '{filename}' -> '{final_name}'")

if __name__ == "__main__":
    print("Sanitizing files for Android compatibility...")
    sanitize_for_android()
    print("Done!")
